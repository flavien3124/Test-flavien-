<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Test ‚Äî Question par question</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root{--bg:#0b0f17;--card:#121a2a;--txt:#e9eefc;--mut:#a9b4d0;--a:#ffcc33;--b:#ff4d6d;}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--txt);}
    .wrap{max-width:820px;margin:0 auto;padding:22px 14px 60px;}
    .card{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.10);border-radius:18px;padding:18px 16px;box-shadow:0 20px 60px rgba(0,0,0,.35);}
    h1{margin:0 0 8px;font-size:22px;}
    p{margin:8px 0;color:var(--mut);line-height:1.35}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .q{font-size:22px;font-weight:800;margin:10px 0 14px;}
    .btn{border:none;border-radius:14px;padding:12px 14px;font-weight:900;cursor:pointer}
    .yes{background:linear-gradient(90deg,var(--a),#ffe07a);color:#1b1403;}
    .no{background:linear-gradient(90deg,var(--b),#ff93a6);color:#24030a;}
    .ghost{background:transparent;border:1px solid rgba(255,255,255,.14);color:var(--txt);font-weight:800;}
    .choices{display:flex;gap:10px;flex-wrap:wrap}
    .choice{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);color:var(--txt);}
    .progress{height:10px;background:rgba(255,255,255,.10);border-radius:999px;overflow:hidden;margin-top:14px}
    .bar{height:100%;width:0%;background:linear-gradient(90deg,var(--a),var(--b));}
    .small{font-size:13px;color:var(--mut);margin-top:10px}
    .hidden{display:none!important}
    table{width:100%;border-collapse:collapse;margin:16px 0;font-size:14px;}
    th,td{padding:8px;text-align:left;border-top:1px solid rgba(255,255,255,0.1);}
    th{background:rgba(255,255,255,0.08);}
    .answers-list, .flavien-box, .pire-box, .impure-box {
      margin: 24px 0;
      padding: 16px;
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.1);
    }
    .flavien-box { background: linear-gradient(135deg, rgba(180,0,0,0.2), rgba(120,0,0,0.1)); border-color: #900; }
    .pire-box   { background: linear-gradient(135deg, rgba(200,0,200,0.2), rgba(140,0,140,0.1)); border-color: #900090; }
    .impure-box { background: linear-gradient(135deg, rgba(255,0,0,0.2), rgba(180,0,0,0.1)); border-color: #c00; }
    .answer-item { margin: 12px 0; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 8px; border-left: 4px solid var(--a); }
    .answer-item strong { color: var(--a); }
    .percent-big { font-size: 36px; font-weight: bold; text-align: center; margin: 12px 0; }
    .comment { text-align: center; font-size: 18px; line-height: 1.4; }
    #radarContainer { margin: 30px auto; max-width: 500px; background: rgba(18,26,42,0.6); border-radius: 16px; padding: 20px; border: 1px solid rgba(255,255,255,0.15); }
  </style>
</head>

<body>
<div class="wrap">
  <div class="card" id="screenIntro">
    <h1>Test (contenu adulte)</h1>
    <p>‚ö†Ô∏è 18+ ‚Ä¢ questions sexuelles / sensibles. Rien n‚Äôest envoy√© : tout reste sur ton t√©l√©phone.</p>
    <div class="row">
      <button class="btn yes" id="startBtn">Commencer</button>
    </div>
  </div>

  <div class="card hidden" id="screenQuiz">
    <div class="small" id="counter"></div>
    <div class="q" id="qText">‚Äî</div>

    <div id="yesnoBlock" class="row hidden">
      <button class="btn yes" id="btnYes">Oui</button>
      <button class="btn no" id="btnNo">Non</button>
    </div>

    <div id="choiceBlock" class="choices hidden"></div>

    <div class="progress"><div class="bar" id="bar"></div></div>

    <div class="row" style="margin-top:14px">
      <button class="btn ghost" id="btnBack">Retour</button>
      <button class="btn ghost" id="btnRestart">Recommencer</button>
    </div>
  </div>

  <div class="card hidden" id="screenResult">
    <h1>R√©sultat</h1>
    <div class="q" id="resultMain">‚Äî</div>
    <div id="resultText">‚Äî</div>

    <div class="flavien-box">
      <h3 style="margin:0 0 12px; text-align:center;">√Ä quel point tu es Flavien ?</h3>
      <div id="flavienPercent" class="percent-big">‚Äî</div>
      <div id="flavienComment" class="comment">‚Äî</div>
    </div>

    <div class="pire-box">
      <h3 style="margin:0 0 12px; text-align:center;">Pire que moi ?</h3>
      <div id="pirePercent" class="percent-big">‚Äî</div>
      <div id="pireComment" class="comment">‚Äî</div>
    </div>

    <div class="impure-box">
      <h3 style="margin:0 0 12px; text-align:center;">Ton score d'impuret√©</h3>
      <div id="impureScore" class="percent-big">‚Äî</div>
      <div id="impureTitle" class="percent-big" style="font-size:28px; margin:8px 0;"></div>
      <div id="impureComment" class="comment">‚Äî</div>
    </div>

    <div id="radarContainer">
      <h3 style="text-align:center; margin-bottom:16px;">Ton profil par cat√©gorie</h3>
      <canvas id="radarChart" style="max-height:450px;"></canvas>
    </div>

    <div class="answers-list">
      <h3 style="margin:0 0 16px 0;">Tes r√©ponses d√©taill√©es</h3>
      <div id="detailedAnswersList"></div>
    </div>

    <div class="row" style="margin-top:24px; flex-wrap:wrap; gap:12px;">
      <button class="btn yes" id="btnReplay">Rejouer</button>
      <button class="btn ghost" id="btnCopyScore">Copier scores</button>
      <button class="btn ghost" id="btnCopyAll">Copier toutes mes r√©ponses</button>
    </div>
  </div>
</div>

<script>
// TES_REPONSES (fix√©es pour comparaison)
const TES_REPONSES = {
  "q1":"Oui","q2":"Oui","q3":"Oui","q3a":"5‚Äì10","q4":"Oui","q4a":"5‚Äì10","q5":"Oui","q5a":"5‚Äì10",
  "q6":"Oui","q7":"Oui","q7a":"4","q8":"Oui","q9":"Oui","q9a":"Oui","q10":"Oui","q11":"Oui",
  "q12":"Oui","q12a":"Oui","q13":"Oui","q14":"Oui","q14a":"9-11","q15":"Oui","q16":"Oui","q17":"Oui",
  "q18":"Oui","q18a":"Les deux","q18b":"Partenaire","q18c":"oui","q18d":"Les deux","q18e":"oui","q18f":"Partenaire",
  "q19":"Oui","q19a":"Toi","q20":"Oui","q20a":"membre de la famille","q20b":"Oui","q20c":"Non","q21":"Oui",
  "q22":"Oui","q22a":"3","q22b":"Oui","q23":"Oui","q24":"Oui","q25":"Oui","q25a":"3","q26":"Oui","q26a":"Partenaire",
  "q27":"Oui","q27a":"Oui","q27b":"Les deux","q28":"Oui","q28a":"chien","q28b":"Oui","q28c":"Oui","q28d":"Oui",
  "q29":"Oui","q29a":"chien","q30":"Oui","q31":"Oui","q32":"Oui","q33":"Oui","q33a":"Oui","q34":"Oui","q34a":"Oui",
  "q34b":"R√©guli√®rement","q35":"Oui","q35a":"9‚Äì10","q36":"Oui","q36a":"13‚Äì20","q37":"Oui","q38":"Oui","q39":"Oui",
  "q39a":"Oui","q39b":"Oui","q40":"Oui","q40a":"Oui","q41":"Oui","q42":"Oui","q42a":"Sale / port√©","q43":"Oui",
  "q46":"Oui","q46a":"Oui et j‚Äôai continu√©","q47":"Oui","q48":"Oui","q49":"Oui","q49a":"Oui","q50":"Oui","q51":"Non",
  "q51b":"Oui","q51c":"Manette / joystick","q52":"Oui","q53":"Oui","q53a":"Juste go√ªt√© du bout de la langue","q54":"Oui",
  "q55":"Oui","q56":"Oui","q57":"Oui","q58":"Oui","q59":"Oui","q60":"Oui","q61":"Oui","q62":"Oui","q63":"Oui",
  "q63a":"Oui","q63b":"Oui, par accident","q64":"Oui","q65":"Oui","q66":"Oui","q67":"Oui","q68":"Oui","q69":"Oui",
  "q70":"Non","q71":"Non","q72":"Oui","q73":"Non","q74":"Non","q75":"Oui","q76":"Oui","q76a":"Je deviens obs√©d√©¬∑e",
  "q77":"Oui","q77a":"J‚Äôai continu√© malgr√© le regret","q78":"Non","q79":"Oui","q80":"Oui","q81":"Oui","q82":"Oui",
  "q83":"Oui","q84":"Oui","q85":"Oui","q86":"Non","q87":"Non","q88":"Oui","q89":"Non","q90":"Oui","q91":"Non",
  "q92":"Non","q93":"Oui","q94":"Non","q95":"Oui","q96":"Oui","q97":"Non","q98":"Oui","q99":"Oui","q100":"Oui",
  "q101":"Oui","q102":"Non","q103":"Oui","q104":"Oui","q105":"Oui","q105a":"Oui","q106":"Oui","q107":"Oui","q107a":"Oui",
  "q108":"Oui"
};

const QUESTIONS = [
  { id:"q1", type:"yesno", text:"As-tu d√©j√† touch√© volontairement les parties intimes d'un camarade ?", next:"q2", weight: 1 },
  { id:"q2", type:"yesno", text:"T'es-tu d√©j√† exhib√© dans un bar ?", next:"q3", weight: 2 },
  { id:"q3", type:"yesno", text:"As-tu d√©j√† √©jacul√© dans une bouteille pour ne pas bouger de ton lit ?", onYes:"q3a", onNo:"q4", weight: 2 },
  { id:"q3a", type:"choice", text:"Combien de fois ?", options:["1","2","3","4","5‚Äì10","10+"], next:"q4" },
  { id:"q4", type:"yesno", text:"As-tu d√©j√† embrass√© une inconnue en bo√Æte ?", onYes:"q4a", onNo:"q5", weight: 1 },
  { id:"q4a", type:"choice", text:"Combien de fois ?", options:["1","2","3","4","5‚Äì10","10+"], next:"q5" },
  { id:"q5", type:"yesno", text:"As-tu d√©j√† tromp√© ?", onYes:"q5a", onNo:"q6", weight: 2 },
  { id:"q5a", type:"choice", text:"Combien de fois ?", options:["1","2","3","4","5‚Äì10","10+"], next:"q6" },
  { id:"q6", type:"yesno", text:"As-tu d√©j√† √©t√© accus√© de viol ?", next:"q7", weight: 10 },
  { id:"q7", type:"yesno", text:"As-tu d√©j√† touch√© √† une drogue ?", onYes:"q7a", onNo:"q8", weight: 5 },
  { id:"q7a", type:"choice", text:"Combien de drogues diff√©rentes ?", options:["1","2","3","4","5‚Äì10","10+"], next:"q8" },
  { id:"q8", type:"yesno", text:"As-tu d√©j√† eu des rapports homosexuels ?", next:"q9", weight: 2 },
  { id:"q9", type:"yesno", text:"As-tu d√©j√† eu des relations avec ton cousin / ta cousine ?", onYes:"q9a", onNo:"q10", weight: 7 },
  { id:"q9a", type:"choice", text:"Avec les deux ?", options:["Oui","Non"], next:"q10" },
  { id:"q10", type:"yesno", text:"T'es-tu d√©j√† fait violer ?", next:"q11", weight: 10 },
  { id:"q11", type:"yesno", text:"As-tu d√©j√† urin√© sur ta m√®re ?", next:"q12", weight: 7 },
  { id:"q12", type:"yesno", text:"T'es-tu d√©j√† fait frapper par ton p√®re ?", onYes:"q12a", onNo:"q13", weight: 2 },
  { id:"q12a", type:"choice", text:"Les gendarmes ont-ils d√ª intervenir ?", options:["Oui","Non"], next:"q13" },
  { id:"q13", type:"yesno", text:"Ton psy t'a d√©j√† dit une phrase du genre : ¬´ vous savez, il y a des gens qui ont de vrais probl√®mes dans la vie ¬ª ?", next:"q14", weight: 2 },
  { id:"q14", type:"yesno", text:"As-tu d√©j√† fait ou re√ßu une fellation avec une personne du m√™me sexe ?", onYes:"q14a", onNo:"q15", weight: 2 },
  { id:"q14a", type:"choice", text:"√Ä quel √¢ge la premi√®re fois ?", options:["9-11","12‚Äì14","15-16","17-18","18+"], next:"q15" },
  { id:"q15", type:"yesno", text:"As-tu d√©j√† eu un rapport dans un parc pour enfants ?", next:"q16", weight: 3 },
  { id:"q16", type:"yesno", text:"As-tu d√©j√† eu un rapport dans une grande roue ?", next:"q17", weight: 2 },
  { id:"q17", type:"yesno", text:"As-tu d√©j√† pratiqu√© l‚Äôanal ?", next:"q18", weight: 1 },
  { id:"q18", type:"yesno", text:"As-tu d√©j√† pratiqu√© le BDSM ?", onYes:"q18a", onNo:"q19", weight: 3 },
  { id:"q18a", type:"choice", text:"Qui √©tait attach√© ?", options:["Toi","Partenaire","Les deux","Personne"], next:"q18b" },
  { id:"q18b", type:"choice", text:"Qui a √©t√© frapp√© ?", options:["Toi","Partenaire","Les deux","Personne"], nextMap:{ "Personne":"q18d", "Toi":"q18c", "Partenaire":"q18c", "Les deux":"q18c" } },
  { id:"q18c", type:"choice", text:"Jusqu‚Äô√† laisser des bleus ?", options:["oui","non"], next:"q18d" },
  { id:"q18d", type:"choice", text:"Qui avait les yeux band√©s ?", options:["Toi","Partenaire","Les deux","Personne"], next:"q18e" },
  { id:"q18e", type:"choice", text:"Utilisation d‚Äôun fouet ?", options:["oui","non"], next:"q18f" },
  { id:"q18f", type:"choice", text:"Gifl√© pendant un rapport ?", options:["Toi","Partenaire","Les deux","Personne"], next:"q19" },
  { id:"q19", type:"yesno", text:"As-tu d√©j√† fait ou re√ßu des griffures pendant un √©bat ?", onYes:"q19a", onNo:"q20", weight: 3 },
  { id:"q19a", type:"choice", text:"Qui a fait les griffures ?", options:["Toi","Partenaire","Les deux"], next:"q20" },
  { id:"q20", type:"yesno", text:"T‚Äôes-tu d√©j√† masturb√© alors qu‚Äôune autre personne non concern√© √©tait pr√©sent dans la pi√®ce ?", onYes:"q20a", onNo:"q21", weight: 3 },
  { id:"q20a", type:"choice", text:"Quel type de tiers √©tait pr√©sent ?", options:["Personne adulte","Enfant","membre de la famille"], next:"q20b" },
  { id:"q20b", type:"choice", text:"Es-tu all√© jusqu‚Äô√† l‚Äôorgasme ?", options:["Oui","Non"], nextMap:{ "Oui":"q20c", "Non":"q21" } },
  { id:"q20c", type:"choice", text:"A t'il re√ßu du sperme/mouille sur lui?", options:["Oui","Non"], nextMap:{ "Oui":"q20d", "Non":"q21" } },
  { id:"q20d", type:"choice", text:"√âtait-ce volontaire ?", options:["Oui","Non"], next:"q21" },
  { id:"q21", type:"yesno", text:"Un membre de ta famille a-t-il d√©j√† d√ª g√©rer les cons√©quences d‚Äôun acte intime te concernant ?", next:"q22", weight: 7 },
  { id:"q22", type:"yesno", text:"As-tu d√©j√† appris √† quelqu‚Äôun comment se masturber ?", onYes:"q22a", onNo:"q23", weight: 1 },
  { id:"q22a", type:"choice", text:"√Ä combien de personnes ?", options:["1","2","3","4","5‚Äì10","10+"], next:"q22b" },
  { id:"q22b", type:"choice", text:"As-tu d√©j√† appris cela √† ton meilleur ami ?", options:["Oui","Non"], next:"q23" },
  { id:"q23", type:"yesno", text:"As-tu d√©j√† r√©pondu √† un appel t√©l√©phonique en plein √©bat ?", next:"q24", weight: 2 },
  { id:"q24", type:"yesno", text:"As-tu d√©j√† urin√© dans le capot d‚Äôune voiture ?", next:"q25", weight: 4 },
  { id:"q25", type:"yesno", text:"As-tu d√©j√† fait perdre la virginit√© √† quelqu‚Äôun ?", onYes:"q25a", onNo:"q26", weight: 1 },
  { id:"q25a", type:"choice", text:"√Ä combien de personnes ?", options:["1","2","3","4","5‚Äì10","10+"], next:"q26" },
  { id:"q26", type:"yesno", text:"As-tu d√©j√† pratiqu√© le ‚Äúchocopouce‚Äù (doigt ins√©r√© dans l‚Äôanus) ?", onYes:"q26a", onNo:"q27", weight: 1 },
  { id:"q26a", type:"choice", text:"Qui l‚Äôa re√ßu ?", options:["Toi","Partenaire","Les deux"], next:"q27" },
  { id:"q27", type:"yesno", text:"As-tu d√©j√† utilis√© un sextoy ?", onYes:"q27a", onNo:"q28", weight: 1 },
  { id:"q27a", type:"choice", text:"√âtait-ce pendant un rapport sexuel ?", options:["Oui","Non"], nextMap:{ "Oui":"q27b", "Non":"q28" } },
  { id:"q27b", type:"choice", text:"Sur qui ?", options:["Toi","Partenaire","Les deux"], next:"q28" },
  { id:"q28", type:"yesno", text:"T‚Äôes-tu d√©j√† masturb√© alors qu‚Äôun animal √©tait dans la piece ?", onYes:"q28a", onNo:"q29", weight: 12 },
  { id:"q28a", type:"choice", text:"Quel type d'animal √©tait pr√©sent ?", options:["chien","chat","lapin","hamster","autre"], next:"q28b" },
  { id:"q28b", type:"choice", text:"Es-tu all√© jusqu‚Äô√† l‚Äôorgasme ?", options:["Oui","Non"], nextMap:{ "Oui":"q28c", "Non":"q29" } },
  { id:"q28c", type:"choice", text:"A t'il re√ßu du sperme/mouille sur lui?", options:["Oui","Non"], nextMap:{ "Oui":"q28d", "Non":"q29" } },
  { id:"q28d", type:"choice", text:"√âtait-ce volontaire ?", options:["Oui","Non"], next:"q29" },
  { id:"q29", type:"yesno", text:"A tu dej√† penser √† avoir un rapport sexuel avec un animal ?", onYes:"q29a", onNo:"q30", weight: 12 },
  { id:"q29a", type:"choice", text:"Quel type d'animal ?", options:["chien","chat","lapin","hamster","cheval","animaux de ferme","autre"], next:"q30" },
  { id:"q30", type:"yesno", text:"As-tu d√©j√† eu un rapport sexuel en pr√©sence d‚Äôune personne non concern√©e dans la pi√®ce ?", next:"q31", weight: 3 },
  { id:"q31", type:"yesno", text:"T‚Äôes-tu d√©j√† dit : ¬´ si je retombe sur des fesses dans les 3 prochains scrolls, je vais sur Pornhub ¬ª ?", next:"q32", weight: 1.5 },
  { id:"q32", type:"yesno", text:"T‚Äôes-tu d√©j√† questionn√© sur l‚Äôorientation sexuelle ou les pratiques de personnages fictifs ?", next:"q33", weight: 2 },
  { id:"q33", type:"yesno", text:"Connais-tu la r√®gle 34 ?", onYes:"q33a", onNo:"q34", weight: 1.5 },
  { id:"q33a", type:"choice", text:"L‚Äôas-tu d√©j√† utilis√©e pour ton plaisir personnel ?", options:["Oui","Non"], next:"q34" },
  { id:"q34", type:"yesno", text:"Consommes-tu des hentais ?", next:"q34a", weight: 1.5 },
  { id:"q34a", type:"choice", text:"As-tu d√©j√† consomm√© du contenu hentai avec des personnages clairement mineurs (loli/shota) ?", options:["Oui","Non"], nextMap:{ "Oui":"q34b", "Non":"q35" } },
  { id:"q34b", type:"choice", text:"√Ä quelle fr√©quence ?", options:["Une fois par curiosit√©", "R√©guli√®rement", "C'est mon genre principal"], next:"q35" },
  { id:"q35", type:"yesno", text:"Te masturbes-tu quotidiennement ?", onYes:"q35a", onNo:"q36", weight: 2 },
  { id:"q35a", type:"choice", text:"Combien de fois par semaine ?", options:["1‚Äì2","3‚Äì4","5‚Äì6","7‚Äì8","9‚Äì10","10+"], next:"q36" },
  { id:"q36", type:"yesno", text:"Consid√®res-tu avoir √©t√© ou √™tre addict √† la masturbation ?", onYes:"q36a", onNo:"q37", weight: 2 },
  { id:"q36a", type:"choice", text:"Nombre maximum de masturbations en une journ√©e ?", options:["1‚Äì3","4‚Äì7","8‚Äì12","13‚Äì20","20+"], next:"q37" },
  { id:"q37", type:"yesno", text:"As-tu d√©j√† particip√© √† une golden shower ?", next:"q38", weight: 4 },
  { id:"q38", type:"yesno", text:"As-tu d√©j√† pris une douche avec une personne du sexe oppos√© (hors famille) ?", next:"q39", weight: 1 },
  { id:"q39", type:"yesno", text:"As-tu d√©j√† utilis√© un doudou pour te masturber ?", onYes:"q39a", onNo:"q40", weight: 4 },
  { id:"q39a", type:"choice", text:"As-tu d√©j√† fait un trou dans le doudou ?", options:["Oui","Non"], next:"q39b" },
  { id:"q39b", type:"choice", text:"As-tu d√©j√† √©jacul√© sur ou dans le doudou ?", options:["Oui","Non"], next:"q40" },
  { id:"q40", type:"yesno", text:"As-tu d√©j√† fantasm√© sur un membre de ta famille proche (fr√®re/s≈ìur, parent, etc.) ?", onYes:"q40a", onNo:"q41", weight: 7 },
  { id:"q40a", type:"choice", text:"As-tu d√©j√† agi dessus (m√™me un simple contact ambigu) ?", options:["Oui", "Non", "Juste un baiser de famille qui a d√©rap√©"], next:"q41" },
  { id:"q41", type:"yesno", text:"As-tu d√©j√† vu un parent / beau-parent nu sans le vouloir (mais tu as regard√© un peu trop longtemps) ?", next:"q42", weight: 7 },
  { id:"q42", type:"yesno", text:"As-tu d√©j√† utilis√© un sous-v√™tement d‚Äôun membre de ta famille pour te masturber ?", onYes:"q42a", onNo:"q43", weight: 7 },
  { id:"q42a", type:"choice", text:"C‚Äô√©tait propre ou sale ?", options:["Propre", "Sale / port√©", "Tr√®s port√© / odeur forte"], next:"q43" },
  { id:"q43", type:"yesno", text:"As-tu d√©j√† laiss√© un animal te l√©cher les parties intimes (m√™me 'par accident') ?", next:"q46", weight: 12 },
  { id:"q46", type:"yesno", text:"T‚Äôa-t-on d√©j√† demand√© de gifler / frapper au visage ton partenaire jusqu‚Äô√† ce qu‚Äôil/elle pleure ?", onYes:"q46a", onNo:"q47", weight: 3 },
  { id:"q46a", type:"choice", text:"As-tu accept√© et l‚Äôas-tu fait ?", options:["Oui et j‚Äôai continu√©", "Oui mais j‚Äôai arr√™t√© avant", "Non, j‚Äôai refus√©"], next:"q47" },
  { id:"q47", type:"yesno", text:"As-tu d√©j√† utilis√© des pinces √† t√©tons / pinces √† linge sur tes parties g√©nitales ?", next:"q48", weight: 3 },
  { id:"q48", type:"yesno", text:"T‚Äôes-tu d√©j√† masturb√©¬∑e dans un magasin (cabine d‚Äôessayage, rayon discret) ?", next:"q49", weight: 3 },
  { id:"q49", type:"yesno", text:"As-tu d√©j√† envoy√© une photo / vid√©o de toi en train de jouir √† quelqu‚Äôun qui ne te conna√Æt pas vraiment ?", onYes:"q49a", onNo:"q50", weight: 3 },
  { id:"q49a", type:"choice", text:"C‚Äô√©tait sur un r√©seau anonyme (Omegle, Discord, etc.) ?", options:["Oui", "Non"], next:"q50" },
  { id:"q50", type:"yesno", text:"As-tu d√©j√† fait semblant d‚Äôavoir un orgasme tr√®s fort pour humilier / faire rire quelqu‚Äôun ?", next:"q51", weight: 2 },
  { id:"q51", type:"yesno", text:"As-tu d√©j√† utilis√© un l√©gume / fruit pour te p√©n√©trer ?", onYes:"q51a", onNo:"q51b", weight: 2 },
  { id:"q51a", type:"choice", text:"Lequel ?", options:["Concombre", "Courgette", "Banane", "Carotte", "Autre truc chelou"], next:"q51b" },
  { id:"q51b", type:"yesno", text:"As-tu d√©j√† utilis√© un objet du quotidien (t√©l√©phone, brosse √† dents, manette de jeu, bouteille d‚Äôeau‚Ä¶) pour te masturber ou te p√©n√©trer ?", onYes:"q51c", onNo:"q52", weight: 2 },
  { id:"q51c", type:"choice", text:"Lequel √©tait le plus inattendu ?", options:["T√©l√©phone vibreur", "Brosse √† dents √©lectrique", "Manette / joystick", "Bouteille / canette", "Autre objet random"], next:"q52" },
  { id:"q52", type:"yesno", text:"As-tu d√©j√† mis ton p√©nis / tes testicules dans un pot de yaourt / cr√®me glac√©e pour le fun ?", next:"q53", weight: 4 },
  { id:"q53", type:"yesno", text:"As-tu d√©j√† bu ton propre sperme (m√™me une goutte) ?", onYes:"q53a", onNo:"q54", weight: 4 },
  { id:"q53a", type:"choice", text:"C‚Äô√©tait volontaire ?", options:["Oui, expr√®s", "Non, accident / d√©fi perdu", "Juste go√ªt√© du bout de la langue"], next:"q54" },
  { id:"q54", type:"yesno", text:"As-tu d√©j√† cherch√© du porno avec des th√®mes ill√©gaux juste par curiosit√© (m√™me sans regarder jusqu‚Äôau bout) ?", next:"q55", weight: 1.5 },
  { id:"q55", type:"yesno", text:"As-tu d√©j√† joui sur une image / vid√©o d‚Äôune c√©l√©brit√© que tu d√©testes ?", next:"q56", weight: 1.5 },
  { id:"q56", type:"yesno", text:"Connais-tu personnellement quelqu‚Äôun qui a fait un revenge porn (ou tu l‚Äôas fait) ?", next:"q57", weight: 2 },
  { id:"q57", type:"yesno", text:"As-tu d√©j√† eu un fantasme o√π tu es forc√©¬∑e / tu forces quelqu‚Äôun (m√™me en imagination pure) ?", next:"q58", weight: 2 },
  { id:"q58", type:"yesno", text:"As-tu d√©j√† bu seul chez toi entre 2 h et 5 h du matin ?", next:"q59", weight: 3 },
  { id:"q59", type:"yesno", text:"T‚Äôes-tu d√©j√† r√©veill√© sans aucun souvenir de la veille, mais avec des preuves photo/vid√©o sur ton t√©l√©phone ?", next:"q60", weight: 3 },
  { id:"q60", type:"yesno", text:"As-tu d√©j√† bu plus de 10 verres en une soir√©e au moins 5 fois dans ta vie ?", next:"q61", weight: 3 },
  { id:"q61", type:"yesno", text:"As-tu d√©j√† fait un before (pr√©-soir√©e) seul avant de sortir ?", next:"q62", weight: 3 },
  { id:"q62", type:"yesno", text:"Consid√®res-tu que 4 pintes c‚Äôest ¬´ juste pour commencer la soir√©e ¬ª ?", next:"q63", weight: 3 },
  { id:"q63", type:"yesno", text:"As-tu d√©j√† vomi √† cause de l'alcool ?", onYes:"q63a", onNo:"q64", weight: 3 },
  { id:"q63a", type:"yesno", text:"As-tu d√©j√† vomi dans un lieu public (rue, bar, m√©tro, parc...) ?", next:"q63b", weight: 3 },
  { id:"q63b", type:"choice", text:"As-tu d√©j√† vomi **sur quelqu‚Äôun** d‚Äôautre ?", options:["Oui, volontairement", "Oui, par accident", "Non, jamais sur quelqu‚Äôun"], next:"q64" },
  { id:"q64", type:"yesno", text:"T‚Äôes-tu d√©j√† disput√© violemment avec quelqu‚Äôun alors que vous √©tiez tous les deux bourr√©s ?", next:"q65", weight: 3 },
  { id:"q65", type:"yesno", text:"As-tu d√©j√† pleur√© en public √† cause de l‚Äôalcool ?", next:"q66", weight: 3 },
  { id:"q66", type:"yesno", text:"As-tu d√©j√† dragu√© / embrass√© quelqu‚Äôun que tu trouvais vraiment moche une fois d√©gris√© ?", next:"q67", weight: 3 },
  { id:"q67", type:"yesno", text:"As-tu d√©j√† envoy√© un message tr√®s g√™nant / tr√®s lourd √† ton ex / crush / patron pendant une cuite ?", next:"q68", weight: 3 },
  { id:"q68", type:"yesno", text:"As-tu d√©j√† conduit (voiture, scooter, v√©lo‚Ä¶) apr√®s avoir clairement trop bu ?", next:"q69", weight: 3 },
  { id:"q69", type:"yesno", text:"As-tu d√©j√† bu au point de tomber dans les pommes / black-out total ?", next:"q70", weight: 3 },
  { id:"q70", type:"yesno", text:"T‚Äôes-tu d√©j√† r√©veill√© chez une personne inconnue sans savoir comment tu y est arriv√© ?", next:"q71", weight: 3 },
  { id:"q71", type:"yesno", text:"As-tu d√©j√† m√©lang√© alcool + m√©dicaments / drogues dures au point d‚Äôavoir vraiment eu peur pour ta sant√© ?", next:"q72", weight: 5 },
  { id:"q72", type:"yesno", text:"As-tu d√©j√† bu directement √† la bouteille en mode ¬´ je m‚Äôen fous ¬ª devant des gens qui te jugeaient ?", next:"q73", weight: 3 },
  { id:"q73", type:"yesno", text:"As-tu d√©j√† bu de l‚Äôalcool dans un cimeti√®re, une √©glise ou un lieu de recueillement ?", next:"q74", weight: 3 },
  { id:"q74", type:"yesno", text:"T‚Äôes-tu d√©j√† saoul√© dans les transports en commun (train, avion, bus longue distance‚Ä¶)", next:"q75", weight: 3 },
  { id:"q75", type:"yesno", text:"As-tu d√©j√† bu de l‚Äôalcool fort au petit-d√©jeuner (ou au moins essay√©) ?", next:"q76", weight: 3 },
  { id:"q76", type:"yesno", text:"L‚Äôalcool te donne-t-il souvent envie de baiser (plus que d‚Äôhabitude) ?", onYes:"q76a", onNo:"q77", weight: 3 },
  { id:"q76a", type:"choice", text:"√Ä quel point ?", options:["Un peu plus que d‚Äôhabitude", "Beaucoup plus", "Je deviens obs√©d√©¬∑e", "Je fais vraiment n‚Äôimporte quoi une fois bourr√©¬∑e"], next:"q77" },
  { id:"q77", type:"yesno", text:"L‚Äôalcool t‚Äôa-t-il d√©j√† fait p√©cho / embrasser / draguer une personne qui te d√©pla√Æt compl√®tement une fois d√©gris√©¬∑e ?", onYes:"q77a", onNo:"q78", weight: 3 },
  { id:"q77a", type:"choice", text:"Si oui, jusqu‚Äôo√π c‚Äôest all√© ?", options:["Juste une galoche / un bisou", "Pr√©liminaires / pelotage lourd", "Sexe complet / p√©n√©tration", "J‚Äôai regrett√© au r√©veil mais j‚Äôai continu√© quand m√™me"], next:"q78" },
  { id:"q78", type:"yesno", text:"As-tu d√©j√† eu un plan cul compl√®tement improvis√© et anonyme sous l‚Äôeffet de l‚Äôalcool ?", next:"q79", weight: 3 },
  { id:"q79", type:"yesno", text:"T‚Äôes-tu d√©j√† retrouv√©¬∑e √† chanter / danser comme un¬∑e fou¬∑folle sur du mauvais son en public √† cause de l‚Äôalcool ?", next:"q80", weight: 3 },
  { id:"q80", type:"yesno", text:"As-tu d√©j√† perdu un objet pr√©cieux (t√©l√©phone, portefeuille, cl√©) pendant une cuite ?", next:"q81", weight: 3 },
  { id:"q81", type:"yesno", text:"As-tu d√©j√† piss√© sur toi ou sur quelqu‚Äôun d‚Äôautre pendant une cuite ?", next:"q82", weight: 4 },
  { id:"q82", type:"yesno", text:"T‚Äôes-tu d√©j√† masturb√© bourr√© en mode ¬´ je regrette tout ¬ª ?", next:"q83", weight: 2 },
  { id:"q83", type:"yesno", text:"As-tu d√©j√† essay√© d‚Äôarr√™ter l‚Äôalcool pendant plus d‚Äôun mois et √©chou√© ?", next:"q84", weight: 3 },
  { id:"q84", type:"yesno", text:"As-tu d√©j√† eu un rapport avec quelqu‚Äôun ayant plus de 10 ans d‚Äô√©cart d‚Äô√¢ge avec toi ?", next:"q85", weight: 2 },
  { id:"q85", type:"yesno", text:"As-tu d√©j√† couch√© avec quelqu‚Äôun de 15‚Äì17 ans alors que tu avais d√©j√† 19 ans ou plus ?", next:"q86", weight: 10 },
  { id:"q86", type:"yesno", text:"As-tu d√©j√† pay√© pour un rapport sexuel ou une prestation sexuelle ?", next:"q87", weight: 6 },
  { id:"q87", type:"yesno", text:"As-tu d√©j√† accept√© de coucher contre de l‚Äôargent, un cadeau cher ou un service important ?", next:"q88", weight: 6 },
  { id:"q88", type:"yesno", text:"As-tu d√©j√† montr√© ton visage + tes parties intimes en direct sur une plateforme publique ou semi-publique (Omegle, Twitch hot, Kick, etc.) ?", next:"q89", weight: 4 },
  { id:"q89", type:"yesno", text:"As-tu d√©j√† film√© ou photographi√© quelqu‚Äôun en train de se masturber ou nu sans qu‚Äôil/elle le sache ?", next:"q90", weight: 10 },
  { id:"q90", type:"yesno", text:"As-tu d√©j√† masturb√© ou fait jouir quelqu‚Äôun dans une salle de cin√©ma (pendant un film normal) ?", next:"q91", weight: 4 },
  { id:"q91", type:"yesno", text:"As-tu d√©j√† jou√© avec du sang menstruel pendant un rapport (le tien ou celui de ta partenaire) ?", next:"q92", weight: 4 },
  { id:"q92", type:"yesno", text:"As-tu d√©j√† demand√© ou accept√© qu‚Äôon te crache dans la bouche pendant un rapport ?", next:"q93", weight: 4 },
  { id:"q93", type:"yesno", text:"As-tu d√©j√† demand√© ou accept√© de cracher dans la bouche de ton partenaire pendant un rapport ?", next:"q94", weight: 4 },
  { id:"q94", type:"yesno", text:"As-tu d√©j√† regard√© ton partenaire se faire baiser par quelqu‚Äôun d‚Äôautre (m√™me une seule fois) ?", next:"q95", weight: 5 },
  { id:"q95", type:"yesno", text:"As-tu d√©j√† demand√© √† ton partenaire de te raconter en d√©tail un plan cul qu‚Äôil/elle a fait sans toi ?", next:"q96", weight: 5 },
  { id:"q96", type:"yesno", text:"As-tu d√©j√† eu un fantasme r√©current o√π tu tortures sexuellement quelqu‚Äôun (m√™me purement imaginaire) ?", next:"q97", weight: 10 },
  { id:"q97", type:"yesno", text:"As-tu d√©j√† pass√© plus de 2 heures d‚Äôaffil√©e sur du porno, OnlyFans, coomeet ou sites similaires en une seule session ?", next:"q98", weight: 1.5 },
  { id:"q98", type:"yesno", text:"As-tu d√©j√† ressenti une honte intense ou pleur√© juste apr√®s avoir joui sur un contenu que tu trouvais toi-m√™me d√©gueulasse ?", next:"q99", weight: 1.5 },
  { id:"q99", type:"yesno", text:"As-tu d√©j√† gard√© des photos/vid√©os intimes d‚Äôun(e) ex ou plan Q sans son accord apr√®s la rupture ?", next:"q100", weight: 10 },
  { id:"q100", type:"yesno", text:"As-tu d√©j√† regard√© quelqu‚Äôun nu ou en train de se masturber par le trou de la serrure, par une fen√™tre ou via une cam√©ra sans qu‚Äôil/elle le sache ?", next:"q101", weight: 10 },
  { id:"q101", type:"yesno", text:"As-tu d√©j√† envoy√© un dick pic, une photo de tes parties ou √©quivalent √† quelqu‚Äôun sans qu‚Äôil/elle l‚Äôait demand√© ?", next:"q102", weight: 4 },
  { id:"q102", type:"yesno", text:"As-tu d√©j√† particip√© √† un plan √† 3 ou plus (gangbang, reverse, orgie organis√©e) ?", onYes:"q102a", onNo:"q103", weight: 4 },
  { id:"q102a", type:"choice", text:"Combien de personnes en plus de toi (total de participants) ?", options:["3","4","5","6","7+"], next:"q103" },
  { id:"q103", type:"yesno", text:"As-tu d√©j√† fait un facesitting ou un dick-to-ride (DTR) jusqu‚Äô√† ce que l‚Äôautre personne ait vraiment du mal √† respirer ?", next:"q104", weight: 3 },
  { id:"q104", type:"yesno", text:"As-tu d√©j√† eu un rapport vaginal ou anal sans contraception ?", next:"q105", weight: 4 },
  { id:"q105", type:"yesno", text:"As-tu d√©j√† couch√© avec plus d'une personne dans la m√™me journ√©e ?", onYes:"q105a", onNo:"q106", weight: 3 },
  { id:"q105a", type:"choice", text:"Avec moins de 3h d'intervalle ?", options:["Oui","Non"], next:"q106" },
  { id:"q106", type:"yesno", text:"As-tu d√©j√† mis dans la bouche un doigt qui √©tait dans l'anus de ton partenaire ?", next:"q107", weight: 4 },
  { id:"q107", type:"yesno", text:"As-tu d√©j√† vu un membre de ta famille violer/agresser sexuellement quelqu‚Äôun ?", onYes:"q107a", onNo:"q108", weight: 15 },
  { id:"q107a", type:"choice", text:"L‚Äôautre personne √©tait-elle aussi de ta famille ?", options:["Oui","Non"], next:"q108" },
  { id:"q108", type:"yesno", text:"As-tu d√©j√† pratiqu√© ou re√ßu une faciale ?", next:null, weight: 2 }
];

const CATEGORIES = {
  "bdsm": { name: "BDSM" },
  "drogue": { name: "DROGUE" },
  "alcool": { name: "ALCOOL" },
  "sexe_classique": { name: "SEXE classique" },
  "famille": { name: "Famille" },
  "hygiene": { name: "Hygi√®ne" },
  "zoophilie": { name: "Zoophilie" },
  "crime": { name: "Crime" },
  "psychologie": { name: "Psychologie" },
  "porno": { name: "Porno" },
  "exhibition": { name: "Exhibition" },
  "homosexuel": { name: "Homosexuel" }
};

const CATEGORY_MAP = {
  "q1":"sexe_classique","q2":"exhibition","q3":"hygiene","q4":"sexe_classique","q5":"sexe_classique",
  "q6":"crime","q7":"drogue","q8":"homosexuel","q9":"famille","q10":"crime","q11":"famille",
  "q12":"psychologie","q13":"psychologie","q14":"homosexuel","q15":"exhibition","q16":"exhibition",
  "q17":"sexe_classique","q18":"bdsm","q19":"bdsm","q20":"exhibition","q21":"famille",
  "q22":"sexe_classique","q23":"exhibition","q24":"hygiene","q25":"sexe_classique","q26":"sexe_classique",
  "q27":"sexe_classique","q28":"zoophilie","q29":"zoophilie","q30":"exhibition","q31":"porno",
  "q32":"psychologie","q33":"porno","q34":"porno","q35":"hygiene","q36":"hygiene","q37":"hygiene",
  "q38":"sexe_classique","q39":"hygiene","q40":"famille","q41":"famille","q42":"famille",
  "q43":"zoophilie","q46":"bdsm","q47":"bdsm","q48":"exhibition","q49":"exhibition",
  "q50":"psychologie","q51":"hygiene","q52":"hygiene","q53":"hygiene","q54":"porno",
  "q55":"porno","q56":"psychologie","q57":"psychologie","q58":"alcool","q59":"alcool",
  "q60":"alcool","q61":"alcool","q62":"alcool","q63":"alcool","q64":"alcool","q65":"alcool",
  "q66":"alcool","q67":"alcool","q68":"alcool","q69":"alcool","q70":"alcool","q71":"alcool",
  "q72":"alcool","q73":"alcool","q74":"alcool","q75":"alcool","q76":"alcool","q77":"alcool",
  "q78":"alcool","q79":"alcool","q80":"alcool","q81":"hygiene","q82":"alcool","q83":"alcool",
  "q84":"sexe_classique","q85":"crime","q86":"crime","q87":"crime","q88":"exhibition",
  "q89":"crime","q90":"exhibition","q91":"hygiene","q92":"hygiene","q93":"hygiene",
  "q94":"sexe_classique","q95":"sexe_classique","q96":"psychologie","q97":"porno","q98":"psychologie",
  "q99":"crime","q100":"crime","q101":"exhibition","q102":"sexe_classique","q103":"bdsm",
  "q104":"sexe_classique","q105":"sexe_classique","q106":"hygiene","q107":"famille","q108":"sexe_classique"
};

Object.keys(CATEGORY_MAP).forEach(id => {
  const q = QUESTIONS.find(qq => qq.id === id);
  if (q && q.type === "yesno") q.category = CATEGORY_MAP[id];
});

const totalYesNoQuestions = QUESTIONS.filter(q => q.type === "yesno").length;

let currentId = null;
let history = [];
let answers = {};
let detailedAnswers = {};
let yesCount = 0;
let extraPenaltyPoints = 0;

const $ = id => document.getElementById(id);
const screenIntro  = $("screenIntro");
const screenQuiz   = $("screenQuiz");
const screenResult = $("screenResult");
const qText    = $("qText");
const counter  = $("counter");
const bar      = $("bar");
const yesnoBlock  = $("yesnoBlock");
const choiceBlock = $("choiceBlock");
const detailedList = $("detailedAnswersList");
const flavienPercentEl = $("flavienPercent");
const flavienCommentEl = $("flavienComment");
const pirePercentEl = $("pirePercent");
const pireCommentEl = $("pireComment");
const impureScoreEl = $("impureScore");
const impureTitleEl = $("impureTitle");
const impureCommentEl = $("impureComment");

// ‚îÄ‚îÄ FONCTIONS DE BASE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function show(el) {
  [screenIntro, screenQuiz, screenResult].forEach(s => s.classList.add("hidden"));
  el.classList.remove("hidden");
}

function resetAll() {
  currentId = QUESTIONS[0]?.id ?? null;
  history = [];
  answers = {};
  detailedAnswers = {};
  yesCount = 0;
  extraPenaltyPoints = 0;
  if (currentId) render();
}

function progressYesNoDone() {
  return QUESTIONS.filter(q => q.type === "yesno" && answers[q.id]).length;
}

function render() {
  const q = QUESTIONS.find(qq => qq.id === currentId);
  if (!q) return;

  qText.textContent = q.text;

  const done = progressYesNoDone();
  counter.textContent = `Progression : ${done} / ${totalYesNoQuestions}`;
  bar.style.width = totalYesNoQuestions ? (done / totalYesNoQuestions * 100) + "%" : "0%";

  yesnoBlock.classList.toggle("hidden", q.type !== "yesno");
  choiceBlock.classList.toggle("hidden", q.type !== "choice");

  if (q.type === "choice") {
    choiceBlock.innerHTML = "";
    q.options.forEach(opt => {
      const b = document.createElement("button");
      b.className = "btn choice";
      b.textContent = opt;
      b.onclick = () => answerChoice(opt);
      choiceBlock.appendChild(b);
    });
  }
}

function go(nextId) {
  if (!nextId) return showResult();
  history.push(currentId);
  currentId = nextId;
  render();
}

function answerYesNo(isYes) {
  const q = QUESTIONS.find(qq => qq.id === currentId);
  if (!q || q.type !== "yesno") return;

  const value = isYes ? "Oui" : "Non";
  answers[q.id] = { type:"yesno", value };
  detailedAnswers[q.id] = { question: q.text, answer: value };

  if (isYes) {
    yesCount++;
    if (["q6","q10","q11","q28","q29","q43","q85","q89","q99","q100","q96","q107"].includes(q.id)) extraPenaltyPoints += 12;
  }

  const nextId = isYes ? (q.onYes ?? q.next) : (q.onNo ?? q.next);
  go(nextId);
}

function answerChoice(value) {
  const q = QUESTIONS.find(qq => qq.id === currentId);
  if (!q || q.type !== "choice") return;

  answers[q.id] = { type:"choice", value };
  detailedAnswers[q.id] = { question: q.text, answer: value };

  extraPenaltyPoints += getChoicePenalty(q.id, value);

  if (q.nextMap && q.nextMap[value] !== undefined) {
    go(q.nextMap[value]);
  } else {
    go(q.next);
  }
}

function getChoicePenalty(qid, val) {
  const penalties = {
    "10+":15, "5‚Äì10":9, "20+":20, "R√©guli√®rement":8, "C'est mon genre principal":12,
    "Enfant":25, "membre de la famille":18, "cheval":30, "animaux de ferme":25,
    "Oui et j‚Äôai continu√©":12, "Tr√®s port√© / odeur forte":10, "Sale / port√©":7,
    "Oui, expr√®s":8, "Autre truc chelou":6, "Autre objet random":5,
    "Sexe complet / p√©n√©tration": 10,
    "Je fais vraiment n‚Äôimporte quoi une fois bourr√©¬∑e": 9,
    "Je deviens obs√©d√©¬∑e": 7,
    "Oui, volontairement": 8,
    "Oui, par accident": 4,
    "Oui": 4, "Non": 1,
    "7+":10, "6":8, "5":6, "4":4, "3":2
  };
  return penalties[val] || 3;
}

function back() {
  if (!history.length) return;
  const prevId = history.pop();
  const prevAns = answers[prevId];

  if (prevAns) {
    if (prevAns.type === "yesno" && prevAns.value === "Oui") yesCount--;
    delete answers[prevId];
    delete detailedAnswers[prevId];
  }
  currentId = prevId;
  render();
}

// ‚îÄ‚îÄ CALCULS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function computeCategoryScores() {
  const catStats = {};
  Object.keys(CATEGORIES).forEach(key => {
    catStats[key] = { yes:0, total:0, name:CATEGORIES[key].name };
  });

  QUESTIONS.forEach(q => {
    if (q.type !== "yesno" || !q.category) return;
    const cat = catStats[q.category];
    cat.total++;
    if (answers[q.id]?.value === "Oui") cat.yes++;
  });

  return Object.values(catStats).filter(c => c.total > 0);
}

function computeFlavienPercent() {
  let score = 0;
  if (detailedAnswers["q107"]?.answer === "Oui" && detailedAnswers["q107a"]?.answer === "Oui") score += 35;
  if (detailedAnswers["q11"]?.answer === "Oui") score += 25;
  if (detailedAnswers["q28"]?.answer === "Oui" && detailedAnswers["q28d"]?.answer === "Oui") score += 30;
  if (detailedAnswers["q43"]?.answer === "Oui") score += 20;
  if (detailedAnswers["q40"]?.answer === "Oui" && detailedAnswers["q40a"]?.answer === "Oui") score += 18;
  if (detailedAnswers["q46a"]?.answer === "Oui et j‚Äôai continu√©") score += 15;
  if (detailedAnswers["q9"]?.answer === "Oui" && detailedAnswers["q9a"]?.answer === "Oui") score += 12;
  if (detailedAnswers["q106"]?.answer === "Oui") score += 10;
  if (["13‚Äì20","20+"].includes(detailedAnswers["q36a"]?.answer)) score += 8;
  if (detailedAnswers["q39b"]?.answer === "Oui") score += 7;
  if (detailedAnswers["q42a"]?.answer === "Tr√®s port√© / odeur forte") score += 6;
  return Math.min(100, score);
}

function getFlavienComment(p) {
  if (p >= 95) return "Flavien ultime ‚Äì l√©gende des abysses üî•";
  if (p >= 80) return "Flavien pur jus, respect total üòà";
  if (p >= 60) return "T‚Äôes clairement dans la team Flavien";
  if (p >= 40) return "T‚Äôas du potentiel Flavien mais faut pousser";
  return "Pas encore Flavien... mais t‚Äôes sur la voie üòè";
}

function computePireQueMoiPercent() {
  let scorePire = 0;

  QUESTIONS.forEach(q => {
    const maRep = TES_REPONSES[q.id];
    const saRep = detailedAnswers[q.id]?.answer;

    if (!maRep || !saRep) return;

    const poids = q.weight || 1;

    if (q.type === "yesno") {
      if (maRep === "Non" && saRep === "Oui") {
        scorePire += poids * 3;
      }
      if (maRep === "Oui" && saRep === "Oui" && poids >= 5) {
        scorePire += poids * 0.8;
      }
    } else if (q.type === "choice") {
      const niveauxPire = {
        "Tr√®s port√© / odeur forte": 15, "Sale / port√©": 10, "Propre": 2,
        "Oui et j‚Äôai continu√©": 20, "Oui mais j‚Äôai arr√™t√© avant": 10, "Non, j‚Äôai refus√©": 0,
        "Je fais vraiment n‚Äôimporte quoi une fois bourr√©¬∑e": 18, "Je deviens obs√©d√©¬∑e": 12,
        "Beaucoup plus": 10, "Un peu plus que d‚Äôhabitude": 4,
        "Sexe complet / p√©n√©tration": 15, "Pr√©liminaires / pelotage lourd": 8, "Juste une galoche / un bisou": 3,
        "Oui, volontairement": 12, "Oui, par accident": 5, "Non, jamais sur quelqu‚Äôun": 0,
        "cheval": 30, "animaux de ferme": 25, "chien": 18, "chat": 12, "lapin": 6, "hamster": 4, "autre": 10,
        "20+": 20, "13‚Äì20": 12,
        "C'est mon genre principal": 15, "R√©guli√®rement": 10, "Une fois par curiosit√©": 3,
        "membre de la famille": 25, "Enfant": 40, "Personne adulte": 5,
        "7+": 12, "6": 10, "5": 8, "4": 6, "3": 4,
        "Les deux": 12, "Toi": 8, "Partenaire": 6, "Personne": 2,
        "oui": 10, "non": 3
      };

      const monNiveau = niveauxPire[maRep] || 5;
      const sonNiveau = niveauxPire[saRep] || 5;

      if (sonNiveau > monNiveau) {
        scorePire += (sonNiveau - monNiveau) * 1.2;
      }
    }
  });

  const maxPossible = 1200;
  let percent = (scorePire / maxPossible) * 100;
  percent = Math.max(0, Math.min(100, Math.round(percent)));

  return percent;
}

function getPireComment(p) {
  if (p >= 90) return "T‚Äôes largement pire que moi... l√©gende du trash üòà";
  if (p >= 70) return "T‚Äôes nettement pire que moi sur plusieurs points";
  if (p >= 50) return "T‚Äôes un bon cran au-dessus de moi en termes de chaos";
  if (p >= 30) return "T‚Äôes d√©j√† un peu plus trash que moi";
  if (p >= 10) return "T‚Äôes l√©g√®rement pire que moi sur quelques trucs";
  return "T‚Äôes au m√™me niveau ou plus soft que moi... pour l'instant üòè";
}

function computeImpureScore() {
  let score = 0;

  QUESTIONS.forEach(q => {
    const rep = answers[q.id]?.value || detailedAnswers[q.id]?.answer;
    if (!rep) return;

    if (q.type === "yesno" && rep === "Oui") {
      if (["q6","q10","q11","q28","q29","q43","q85","q89","q99","q100","q96","q107"].includes(q.id)) {
        score += (q.weight || 1) * 6;
      } else if (q.weight >= 5) {
        score += (q.weight || 1) * 3;
      } else {
        score += (q.weight || 1) * 1;
      }
    }

    if (q.type === "choice") {
      const niveaux = {
        "Tr√®s port√© / odeur forte": 10, "Sale / port√©": 6, "Propre": 1,
        "Oui et j‚Äôai continu√©": 15, "Oui mais j‚Äôai arr√™t√© avant": 8, "Non, j‚Äôai refus√©": 0,
        "Je fais vraiment n‚Äôimporte quoi une fois bourr√©¬∑e": 12, "Je deviens obs√©d√©¬∑e": 9,
        "Beaucoup plus": 6, "Un peu plus que d‚Äôhabitude": 2,
        "Sexe complet / p√©n√©tration": 11, "Pr√©liminaires / pelotage lourd": 6, "Juste une galoche / un bisou": 2,
        "Oui, volontairement": 8, "Oui, par accident": 4, "Non, jamais sur quelqu‚Äôun": 0,
        "cheval": 25, "animaux de ferme": 19, "chien": 12, "chat": 8, "lapin": 4, "hamster": 2, "autre": 6,
        "20+": 15, "13‚Äì20": 10,
        "C'est mon genre principal": 12, "R√©guli√®rement": 8, "Une fois par curiosit√©": 2,
        "membre de la famille": 18, "Enfant": 31, "Personne adulte": 4,
        "Les deux": 9, "Toi": 6, "Partenaire": 5, "Personne": 1,
        "oui": 8, "non": 0
      };
      score += niveaux[rep] || 3;
    }
  });

  // Bonus cumul graves (r√©duits)
  if (detailedAnswers["q107"]?.answer === "Oui" && detailedAnswers["q107a"]?.answer === "Oui") score += 19;
  if (detailedAnswers["q11"]?.answer === "Oui") score += 15;
  if (detailedAnswers["q28"]?.answer === "Oui" && detailedAnswers["q28d"]?.answer === "Oui") score += 18;
  if (detailedAnswers["q43"]?.answer === "Oui") score += 12;

  return Math.min(1000, Math.round(score));
}

function getImpureTitle(score) {
  if (score >= 900) return "L√©gende des Abysses";
  if (score >= 750) return "Seigneur des T√©n√®bres";
  if (score >= 600) return "√Çme damn√©e";
  if (score >= 450) return "Voyageur du Chaos";
  if (score >= 300) return "√Çme tourment√©e";
  if (score >= 150) return "Mortel audacieux";
  return "Pur comme la neige";
}

function getImpureComment(score) {
  if (score >= 900) return "Score extr√™me. Tu es dans les abysses les plus sombres. Risques l√©gaux tr√®s graves, d√©pendances destructrices, dommages psychologiques profonds. Consulte imm√©diatement un professionnel.";
  if (score >= 750) return "Niveau tr√®s dangereux. Tu touches √† des zones interdites et risqu√©es. Attention s√©rieuse √† ta libert√© et √† ta sant√© mentale.";
  if (score >= 600) return "Impuret√© forte. Zone rouge : comportements √† haut risque, cons√©quences l√©gales ou sociales possibles.";
  if (score >= 450) return "Impuret√© marqu√©e. Tu d√©passes largement la norme. Risque d'addictions et de d√©rapages.";
  if (score >= 300) return "Impuret√© mod√©r√©e. Zone grise : certains actes sont borderline. Vigilance recommand√©e.";
  if (score >= 150) return "Impuret√© l√©g√®re. Tu es un peu plus audacieux que la moyenne, mais encore dans une zone relativement s√ªre.";
  return "Puret√© √©lev√©e. Comportements sains, peu de risques. Tu restes dans la norme ou m√™me au-dessus.";
}

function showResult() {
  show(screenResult);

  const flavien = computeFlavienPercent();
  const pire = computePireQueMoiPercent();
  const impureScore = computeImpureScore();

  $("resultMain").innerHTML = `R√©sultat d√©taill√©`;

  const cats = computeCategoryScores();
  let html = `<p>Oui aux questions yes/no : ${yesCount} / ${totalYesNoQuestions}</p>`;
  html += `<table><tr><th>Cat√©gorie</th><th>Puret√©</th><th>Oui</th></tr>`;
  cats.forEach(cat => {
    const catPurity = cat.total ? Math.round((cat.total - cat.yes) / cat.total * 100) : 0;
    let color = catPurity >= 80 ? "#88ff88" : catPurity >= 50 ? "#ffdd88" : "#ff8888";
    html += `<tr><td>${cat.name}</td><td style="color:${color}">${catPurity}%</td><td>${cat.yes}/${cat.total}</td></tr>`;
  });
  html += `</table>`;
  $("resultText").innerHTML = html;

  flavienPercentEl.textContent = `${flavien}%`;
  flavienCommentEl.textContent = getFlavienComment(flavien);

  pirePercentEl.textContent = `${pire}%`;
  pireCommentEl.textContent = getPireComment(pire);

  impureScoreEl.textContent = `${impureScore} / 1000`;
  impureTitleEl.textContent = getImpureTitle(impureScore);
  impureCommentEl.textContent = getImpureComment(impureScore);

  let answersHtml = "";
  QUESTIONS.forEach(q => {
    if (detailedAnswers[q.id]) {
      const d = detailedAnswers[q.id];
      answersHtml += `
        <div class="answer-item">
          <strong>${q.id.toUpperCase()}</strong><br>
          ${d.question}<br>
          <span style="color:var(--mut)">‚Üí ${d.answer}</span>
        </div>`;
    }
  });
  detailedList.innerHTML = answersHtml || "<p>Aucune r√©ponse.</p>";

  const ctx = document.getElementById('radarChart').getContext('2d');

  const labels = cats.map(cat => cat.name);
  const data = cats.map(cat => {
    return cat.total ? Math.round((cat.total - cat.yes) / cat.total * 100) : 0;
  });

  if (window.myRadar) window.myRadar.destroy();

  window.myRadar = new Chart(ctx, {
    type: 'radar',
    data: {
      labels: labels,
      datasets: [{
        label: 'Puret√© par cat√©gorie',
        data: data,
        backgroundColor: 'rgba(255, 77, 109, 0.12)',
        borderColor: '#ff4d6d',
        pointBackgroundColor: '#ff4d6d',
        pointBorderColor: '#fff',
        pointHoverBackgroundColor: '#fff',
        pointHoverBorderColor: '#ff4d6d',
        borderWidth: 3,
        pointRadius: 5,
        pointHoverRadius: 8,
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: { legend: { display: false } },
      scales: {
        r: {
          angleLines: { color: 'rgba(255,255,255,0.15)' },
          grid: { color: 'rgba(255,255,255,0.08)' },
          pointLabels: { color: '#e9eefc', font: { size: 12 } },
          ticks: { color: '#a9b4d0', backdropColor: 'transparent', stepSize: 25, min: 0, max: 100 },
          min: 0,
          max: 100
        }
      }
    }
  });

  window.__resultText = `Flavien: ${flavien}% - ${getFlavienComment(flavien)}\n` +
    `Pire que moi: ${pire}% - ${getPireComment(pire)}\n` +
    `Impuret√©: ${impureScore} / 1000 - ${getImpureTitle(impureScore)} - ${getImpureComment(impureScore)}\n\n` +
    `R√©ponses:\n` + Object.entries(detailedAnswers).map(([id, d]) => `${id}: ${d.answer}`).join("\n");
}

// ‚îÄ‚îÄ √âV√âNEMENTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
$("startBtn").onclick   = () => { show(screenQuiz); resetAll(); };
$("btnYes").onclick     = () => answerYesNo(true);
$("btnNo").onclick      = () => answerYesNo(false);
$("btnBack").onclick    = back;
$("btnRestart").onclick = resetAll;
$("btnReplay").onclick  = () => { show(screenQuiz); resetAll(); };

$("btnCopyScore").onclick = async () => {
  const impureScore = computeImpureScore();
  const text = `Flavien: ${computeFlavienPercent()}% - ${getFlavienComment(computeFlavienPercent())}\n` +
    `Pire que moi: ${computePireQueMoiPercent()}% - ${getPireComment(computePireQueMoiPercent())}\n` +
    `Impuret√©: ${impureScore} / 1000 - ${getImpureTitle(impureScore)} - ${getImpureComment(impureScore)}`;
  try {
    await navigator.clipboard.writeText(text);
    $("btnCopyScore").textContent = "Scores copi√©s ‚úì";
    setTimeout(() => $("btnCopyScore").textContent = "Copier scores", 1500);
  } catch {}
};

$("btnCopyAll").onclick = async () => {
  try {
    await navigator.clipboard.writeText(window.__resultText || "Pas de r√©sultat");
    $("btnCopyAll").textContent = "Copi√© ‚úì";
    setTimeout(() => $("btnCopyAll").textContent = "Copier toutes mes r√©ponses", 1500);
  } catch {}
};
</script>
</body>
</html>